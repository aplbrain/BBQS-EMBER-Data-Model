[tox]
envlist = validate,jsonschema,lint
skipsdist = true

[testenv]
basepython = python3

[testenv:validate]
description = Validate all project YAML files against the LinkML schema
deps =
    linkml>=1.9.0
commands =
    bash -c 'for f in EMBER_Metadata/schema/[RU]*.yaml; do echo "Validating $f..."; linkml-validate -s EMBER_Metadata/schema/ember_project_metadata.yaml "$f" || exit 1; done'
allowlist_externals = bash

[testenv:jsonschema]
description = Generate JSON Schema from LinkML schema
deps =
    linkml>=1.9.0
commands =
    bash -c 'gen-json-schema --top-class EmberProject EMBER_Metadata/schema/ember_project_metadata.yaml > /dev/null'
allowlist_externals = bash

[testenv:lint]
description = Lint YAML files for syntax errors
deps =
    yamllint>=1.35.0
commands =
    yamllint EMBER_Metadata/schema/

[testenv:docs]
description = Generate documentation from LinkML schema
deps =
    linkml>=1.9.0
commands =
    gen-markdown EMBER_Metadata/schema/ember_project_metadata.yaml -d docs/
allowlist_externals = mkdir

[gh-actions]
python =
    3.10: validate, jsonschema, lint
    3.11: validate, jsonschema, lint
    3.12: validate, jsonschema, lint
